<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div id="nav"></div>
    <h1>Edit License</h1>
    <form action="" onsubmit="event.preventDefault()">
        <div id="form"></div>
        <button onclick="submitFn(event)">Submit</button>
        <button onclick="back(event)">cancel</button>
    </form>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script>
        
        let def = {
            "username": "gokul@gmail.com",
            "macAddress": "cc:2f:71:12:84:2c",
            "machineName": "gokulpc",
            "drive": "C",
            "gsa_type": "service_account",
            "gsa_project_id": "psyched-age-387016",
            "gsa_private_key_id": "ec49a5371789bd62d3b158bece5fa5b0bfa0bba1",
            "gsa_private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCm0tqWX+cO/Rbc\nv7KhGP0ngTbH1g1KI7qrwoPVj9XTEqg6QsMs5UX1i9FwHqf3XIviJLC1480CJnY/\nTISpePYGyOUPtAedVBesBi2Z6ADwZ1ELoqcxjXq5CYr/JLjdflB0GQ63gk9alYLB\nVPbE8Sf8wiIU4NzUgORx8MkgW9eVV0CKl8Jhlsw74Hi76QaDr5XwYz3V2B4OJd/p\nxQHsB/JcaM2KF7bCGJ6v7A7REiFx2WqmpG9suuoxqUlHvL6Tn/YlnTg/ljAynSrP\nWbo5Mjw7P+EEU/4HrArMJkYMJrEIn6iMiisjvbjQ6qFg2s08ndorgzfPsePtzQlH\nPyuv9z+pAgMBAAECggEABdJynZWkf4U1RBg+cdPzTtVaE0ns7g8r6OoUQN1rl8RC\njID6D+IDCb16067Fi32b0KqZjl7a77tQ/Gcis0maTX+QoKEL9Hwj34WE19FCiiFS\n8To4m03omuwCjA0Xf2cU2U5qu/G6FwCu3umEu2K+s7oAkj8MRJrTI4evn0Jb9mAL\nYoCJ24yQRf1pUPY7YJUSe09D0mgbI/U55gLxVU27bv4uPo/x4nEEGFyhqBH1Xsxl\nPMbx4I8cJe1BgslS+9XJM4IRlIxQBISMJSND7ylaEtT//7OCA9Q99dJugF9BvTEQ\nrNWhQcSoV2/RnnuN9pCKIQwQDylX8rwutPR7PtI3EQKBgQDj/zd1rvkvj3gJIPhF\nXnpzDSnw9BQe/S1E8/Q3gsWI1sLtTXcFdE/RV9iEzVmkdwttd8/8YvIt914j/Nei\nf8aVCMHp1+cWODRK3P5rxmVNk+lEQfTxNbYQ7Qea2HGA+6r42R8RB39P2mmsRG18\ncbwkRkvx6/TlUIUDErklv8bCWQKBgQC7UDLjEinTLQTpqDBl8h0sD2cVE5TEbGgu\nB1+MI2aCkYg1GMkHjmL6LNLpzlZbvJXmetJhToSZlQ26ZwCdCplW0eHSHtmrFRLY\nb6s1oKT+o3y+C1eYw/9Hvf4Csw5nfii5UbM4IwP+x8jI8NlxZ+VlfCHoCYPfI+Cd\ncLSBoVKd0QKBgQCaT2311IsKyYtwgkQGjz9JByvPzSKhJrGw7Xvo5jVTvCcJ/VgE\n9QfgpBgDKgj16yxs1p6KL13CBp5MtSAs91YsIFU+M8ZPn5Kk6JW50/lUXDuQ2yMw\n7i1fn016W+vWZH7/FdSU7gIYxbanxVhk1YWE958HCbAiVDDyN4XgKsAXYQKBgDJO\nUqxbV3JIt/YM3pqykJUhudyWOrEaMEyUXFvlsgVFEqC3/F2UJw7rdOWoLddLabLR\nr6jEjqY0utAiE68Zhp8jlRN6h5kD+uC39PJdJ5Lf04Oyxh7YHLpm005kSm0PG97R\ni2F7PfpyK4GT9cIYViqQUQbhb1JBb3S5LTFXYznRAoGAc12iQVn1o1Gsuo0Yq+yY\nbqQzdeWqariv9H8Pflk/Lwjg2s6Zr5/BWdW0Dhoyq4qmRwTBc+t4pR1ReO8ozb7/\ngABsmTuPBuicQtEEzzpCt9LDpJ20cq6LemM3Hbot3z9BHOk+Gw3KGK93HCTPf1v3\n2ecvSrReMmLlnEcsyrzCUz8=\n-----END PRIVATE KEY-----\n",
            "gsa_client_email": "id-0001@psyched-age-387016.iam.gserviceaccount.com",
            "gsa_client_id": "100740237978025509761",
            "gsa_auth_uri": "https://accounts.google.com/o/oauth2/auth",
            "gsa_token_uri": "https://oauth2.googleapis.com/token",
            "gsa_auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
            "gsa_client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/id-0001%40psyched-age-387016.iam.gserviceaccount.com",
            "gsa_universe_domain": "googleapis.com",
            "bc_0_filePath": "C:/AHK",
            "bc_0_driveFolder": "1AWeLtz91noN3tX2HwUcZ5GgpDp7puGao",
            "bc_0_fileName": "test",
            "bc_1_filePath": "C:/AHK",
            "bc_1_driveFolder": "1AWeLtz91noN3tX2HwUcZ5GgpDp7puGao",
            "bc_1_fileName": "test",
            "bc_2_filePath": "C:/AHK",
            "bc_2_driveFolder": "1AWeLtz91noN3tX2HwUcZ5GgpDp7puGao",
            "bc_2_fileName": "test",
            "backup": true,
        }

        let def_list = Object.keys(def)
        const requestOptions = {
            method: "GET",
            headers: {
                "Authorization": "Bearer " + localStorage.getItem("token"),
            }
        };

        fetch(`${localStorage.getItem("url")}/license?id=${localStorage.getItem("license")}`, requestOptions)
            .then(response => response.json())
            .then(data => {
                let single = data.data

                //morph data 
                let { googleServicAcc, backupConfig, ...rest } = { ...single }
                let a = { ...rest }

                let gsa = {}
                for (item of Object.keys(googleServicAcc)) {
                    gsa["gsa_" + item] = googleServicAcc[item]
                }

                let bc_0 = {}
                try {
                    for (item of Object.keys(backupConfig[0])) {
                        bc_0["bc_0_" + item] = backupConfig[0][item]
                    }
                } catch {
                    bc_0 = false
                }

                let bc_1 = {}
                try {
                    for (item of Object.keys(backupConfig[1])) {
                        bc_1["bc_1_" + item] = backupConfig[1][item]
                    }
                } catch {
                    bc_1 = false
                }

                let bc_2 = {}
                try {
                    for (item of Object.keys(backupConfig[2])) {
                        bc_2["bc_2_" + item] = backupConfig[2][item]
                    }
                } catch {
                    bc_2 = false
                }


                let getData = { ...a, ...gsa }
                bc_0 ? getData = { ...getData, ...bc_0 } : x = "";
                bc_1 ? getData = { ...getData, ...bc_1 } : x = "";
                bc_2 ? getData = { ...getData, ...bc_2 } : x = "";

                // console.log("getdata", getData)

                //create form 


                let form = document.getElementById("form");
                for (let i = 0; i < def_list.length; i++) {
                    let label = document.createElement("label");

                    label.textContent = def_list[i]
                    let input = document.createElement("input");
                    input.setAttribute("id", def_list[i]);

                    input.setAttribute("size", "50");
                    input.style.marginLeft = "10px";
                    input.style.marginBottom = "10px";

                    if (def_list[i] == "gsa_client_x509_cert_url" || def_list[i] == "gsa_private_key") {
                        input.setAttribute("size", "50");
                    }

                    if (def_list[i] == "backup") {
                        input.setAttribute("type", "checkbox");
                        if (getData.hasOwnProperty(def_list[i])) {
                            input.checked = getData[def_list[i]]
                        }
                    } else {
                        if (getData.hasOwnProperty(def_list[i])) {
                            input.value = getData[def_list[i]]
                        }
                    }
                    form.appendChild(label)
                    form.appendChild(input)
                    let space = document.createElement("br")
                    form.appendChild(space)
                }

            })

        function back() {
            window.location.href = "license.html";
        }
        function submitFn(event) {
            event.preventDefault()
            let data = {}
            for (let i = 0; i < def_list.length; i++) {

                if (def_list[i] == "backup") {
                    let boolvalue = document.getElementById(def_list[i])
                    data[def_list[i]] = boolvalue.checked ? true : false
                } else {

                    data[def_list[i]] = document.getElementById(def_list[i]).value
                }

            }
            // case a
            let arr = Object.keys(data)
            let x;
            let a = {};
            let b = {};
            let c = {};
            let d = {};
            let e = {};

            for (let i = 0; i < arr.length; i++) {
                // b[arr[i].substring(4)] = data[arr[i]];
                arr[i].startsWith("gsa") || arr[i].startsWith("bc") ? x = "" : a[arr[i]] = data[arr[i]]; //case a
                arr[i].startsWith("gsa") ? b[arr[i].substring(4)] = data[arr[i]] : x = "";//case d
                arr[i].startsWith("bc_0") ? c[arr[i].substring(5)] = data[arr[i]] : x = "";// case b
                arr[i].startsWith("bc_1") ? d[arr[i].substring(5)] = data[arr[i]] : x = "";// case c
                arr[i].startsWith("bc_2") ? e[arr[i].substring(5)] = data[arr[i]] : x = "";//case d    
                // g = {...a[i]}
            }
            let f = [c]

            d.fileName == "" ? x = "" : f.push(d)
            e.fileName == "" ? x = "" : f.push(e)
            let g = { ...a, googleServicAcc: b, backupConfig: f }

            console.log(g)
            const requestOptions = {
                method: "PUT",
                headers: {
                    "Authorization": "Bearer " + localStorage.getItem("token"),
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(g)
            };

            fetch(`${localStorage.getItem("url")}/license?id=${localStorage.getItem("license")}`, requestOptions)
                .then(response => {
                    if (response.ok) {
                        console.log('POST request successful');
                        window.location.href = "license.html";
                    } else {
                        console.log('POST request failed');
                    }
                })
                .catch(error => {
                    console.log('Error:', error);
                });
        }




    </script>
    <script>
        $(function () {
            $("#nav").load("nav.html");
        });

    </script>
</body>

</html>